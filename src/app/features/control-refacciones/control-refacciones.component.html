<div class="toolbar">
  <div class="toolbar-left">
    <a class="toolbar-title" routerLink="/home">Inicio</a>
    <a class="toolbar-title" routerLink="/register-solicitudes"
      >Registro de Solicitudes</a
    >
    <a class="toolbar-title" routerLink="/solicitudes">Solicitudes</a>
    <a class="toolbar-title active" routerLink="/control-refacciones"
      >Control de Refacciones</a
    >
    <a class="toolbar-title" routerLink="/refacciones">Refacciones</a>
    <a class="toolbar-title" routerLink="/accesos-permisos">Accesos/Permisos</a>
  </div>
  <div class="toolbar-right">
    <div class="dropdown">
      <span class="profile">
        <i class="fas fa-user"></i> Perfil
        <i class="fa fa-caret-down"></i>
      </span>
      <div class="dropdown-content">
        <a (click)="logout()">Cerrar sesión</a>
      </div>
    </div>
  </div>
</div>

<div class="refacciones-container">
  <div class="header">
    <div class="logo">
      <h1>Control de Refacciones</h1>
      <p>Administración de inventario de refacciones</p>
    </div>
  </div>

  <div class="main-content">
    <div class="actions-section">
      <div class="action-buttons">
        <button class="action-button success" (click)="guardarArticulo()">
          <i class="fas fa-save"></i>
          {{ estaEditando ? "Actualizar" : "Guardar" }}
        </button>
        <button
          class="action-button danger"
          *ngIf="estaEditando"
          (click)="eliminarArticulo()"
        >
          <i class="fas fa-trash"></i> Eliminar
        </button>
        <button class="action-button info" (click)="nuevoArticulo()">
          <i class="fas fa-plus"></i> Nuevo
        </button>
      </div>
    </div>

    <div class="article-section">
      <div class="article-header">
        <h2>Artículo:</h2>
        <div class="article-key">
          <label>Clave Interna:</label>
          <input
            type="text"
            placeholder="Clave única del artículo"
            [(ngModel)]="articulo.clave_interna"
            [disabled]="estaEditando"
          />
        </div>
      </div>

      <div class="article-details-grid">
        <!-- Primera fila - 4 columnas -->
        <div class="detail-group">
          <label>Cliente</label>
          <input type="text" [(ngModel)]="articulo.cliente" />
        </div>
        <div class="detail-group">
          <label>Empresa</label>
          <input type="text" [(ngModel)]="articulo.empresa" />
        </div>
        <div class="detail-group">
          <label>Cantidad</label>
          <input type="number" [(ngModel)]="articulo.cantidad" />
        </div>
        <div class="detail-group">
          <label>Disponible</label>
          <select [(ngModel)]="articulo.disponible">
            <option [value]="true">Sí</option>
            <option [value]="false">No</option>
          </select>
        </div>
        <!-- Segunda fila -->
        <div class="detail-group">
          <label>Unidad de medida</label>
          <input type="text" [(ngModel)]="articulo.unidad_medida" />
        </div>

        <div class="detail-group">
          <label>Estado del artículo</label>
          <input type="text" [(ngModel)]="articulo.estado_articulo" />
        </div>
        <div class="detail-group">
          <label>Costo de compra</label>
          <input
            type="number"
            step="0.01"
            [(ngModel)]="articulo.costo_compra"
          />
        </div>
        <div class="detail-group">
          <label>Rack</label>
          <input type="text" [(ngModel)]="articulo.rack" />
        </div>
        <!-- Tercera fila -->
        <div class="detail-group">
          <label>Cajón</label>
          <input type="text" [(ngModel)]="articulo.cajon" />
        </div>

        <div class="detail-group">
          <label>Categoría 1</label>
          <input type="text" [(ngModel)]="articulo.categoria1" />
        </div>
        <div class="detail-group">
          <label>Categoría 2</label>
          <input type="text" [(ngModel)]="articulo.categoria2" />
        </div>
        <div class="detail-group">
          <label>Categoría 3</label>
          <input type="text" [(ngModel)]="articulo.categoria3" />
        </div>
        <!-- Cuarta fila -->
        <div class="detail-group">
          <label>Categoría 4</label>
          <input type="text" [(ngModel)]="articulo.categoria4" />
        </div>
        <div class="detail-group">
          <label>Categoría 5</label>
          <input type="text" [(ngModel)]="articulo.categoria5" />
        </div>
        <!-- Descripción completa -->
        <div class="detail-group full-width">
          <label>Descripción</label>
          <textarea
            placeholder="Descripción detallada del artículo"
            [(ngModel)]="articulo.descripcion"
          ></textarea>
        </div>
        <!-- Archivo -->
        <div class="detail-group file-upload-group full-width">
          <label>Archivo Adjunto</label>
          <div class="file-upload-container">
            <label class="file-upload-label">
              <input
                type="file"
                (change)="onFileSelected($event)"
                style="display: none"
              />
              <i class="fas fa-file-upload"></i>
              <span>{{ archivoNombre }}</span>
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de archivos adjuntos -->
    <div
      class="attached-files"
      *ngIf="
        estaEditando &&
        articulo.archivosAdjuntos &&
        articulo.archivosAdjuntos.length > 0
      "
    >
      <h3>Archivos Adjuntos</h3>
      <ul>
        <li *ngFor="let archivo of articulo.archivosAdjuntos">
          <span>{{ archivo.nombre_archivo }}</span>
          <div class="file-actions">
            <button
              class="action-button info small"
              (click)="descargarArchivo(archivo.id)"
            >
              <i class="fas fa-download"></i>
            </button>
            <button
              class="action-button danger small"
              (click)="eliminarArchivo(archivo.id)"
            >
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </li>
      </ul>
    </div>

    <!-- Botón para solicitar pedido -->
    <div class="actions-section" *ngIf="estaEditando">
      <button class="action-button primary" (click)="solicitarPedido()">
        <i class="fas fa-clipboard-list"></i> Solicitar Pedido
      </button>
    </div>

    <!-- Sección de información de solicitud -->
    <div
      class="solicitud-section"
      *ngIf="estaEditando && articulo.estado_solicitud"
    >
      <h3>Información de Solicitud</h3>
      <div class="solicitud-details">
        <div>
          <strong>Estado:</strong> {{ articulo.estado_solicitud | titlecase }}
        </div>
        <div *ngIf="articulo.solicitante">
          <strong>Solicitante:</strong> {{ articulo.solicitante }}
        </div>
        <div *ngIf="articulo.departamento">
          <strong>Departamento:</strong> {{ articulo.departamento }}
        </div>
        <div *ngIf="articulo.fecha_requerida">
          <strong>Fecha Requerida:</strong> {{ articulo.fecha_requerida }}
        </div>
        <div *ngIf="articulo.prioridad">
          <strong>Prioridad:</strong> {{ articulo.prioridad | titlecase }}
        </div>
        <div *ngIf="articulo.notas_solicitud">
          <strong>Notas:</strong> {{ articulo.notas_solicitud }}
        </div>
      </div>
    </div>

    <!-- Formulario de solicitud de pedido (modal) -->
    <div class="modal-overlay" *ngIf="mostrandoFormularioPedido">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Solicitud de Pedido para {{ articulo.clave_interna }}</h3>
          <button class="close-button" (click)="cancelarSolicitud()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Solicitante:</label>
            <input
              type="text"
              [(ngModel)]="articulo.solicitante"
              placeholder="Nombre del solicitante"
              required
            />
          </div>

          <div class="form-group">
            <label>Departamento:</label>
            <input
              type="text"
              [(ngModel)]="articulo.departamento"
              placeholder="Departamento"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Fecha Requerida:</label>
              <input type="date" [(ngModel)]="articulo.fecha_requerida" />
            </div>

            <div class="form-group">
              <label>Prioridad:</label>
              <select [(ngModel)]="articulo.prioridad">
                <option value="baja">Baja</option>
                <option value="normal" selected>Normal</option>
                <option value="alta">Alta</option>
                <option value="urgente">Urgente</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Notas:</label>
            <textarea
              [(ngModel)]="articulo.notas_solicitud"
              placeholder="Notas adicionales..."
            ></textarea>
          </div>

          <div class="form-group">
            <label>Estado de Solicitud:</label>
            <select [(ngModel)]="articulo.estado_solicitud">
              <option value="pendiente">Pendiente</option>
              <option value="aprobado">Aprobado</option>
              <option value="rechazado">Rechazado</option>
              <option value="completado">Completado</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="action-button danger" (click)="cancelarSolicitud()">
            Cancelar
          </button>
          <button
            class="action-button success"
            (click)="enviarSolicitudPedido()"
          >
            Enviar Solicitud
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<router-outlet></router-outlet>
