<div class="solicitudes-container">
  <header class="header">
    <div class="logo">
      <h1>BizBud</h1>
      <p>Gestión de solicitudes</p>
    </div>

    <nav class="main-nav">
      <ul>
        <li>
          <a routerLink="/home"><i class="fas fa-home"></i> Inicio</a>
        </li>
        <li class="active">
          <a routerLink="/solicitudes"
            ><i class="fas fa-list"></i> Solicitudes</a
          >
        </li>
        <li>
          <a routerLink="/control-refacciones"
            ><i class="fas fa-cogs"></i> Control de Refacciones</a
          >
        </li>
        <li>
          <a routerLink="/accesos-permisos"
            ><i class="fas fa-user-shield"></i> Accesos/Permisos</a
          >
        </li>
        <li class="dropdown">
          <a href="javascript:void(0)">
            <i class="fas fa-user"></i> Perfil <i class="fa fa-caret-down"></i>
          </a>
          <div class="dropdown-content">
            <a (click)="logout()">Cerrar sesión</a>
          </div>
        </li>
      </ul>
    </nav>
  </header>

  <main class="main-content">
    <section class="actions-section">
      <div class="action-dropdown">
        <button class="action-button" (click)="mostrarFormularioFactura()">
          <i class="fas fa-file-invoice-dollar"></i> Facturar
        </button>
      </div>

      <div class="action-dropdown">
        <button class="action-button" (click)="mostrarFormularioEnterado()">
          <i class="fas fa-check-circle"></i> Enterado
        </button>
      </div>

      <div class="filters">
        <div class="filter-group">
          <label for="busqueda">Buscar:</label>
          <input
            type="text"
            id="busqueda"
            [(ngModel)]="terminoBusqueda"
            (input)="filtrarSolicitudes()"
            placeholder="Cliente, solicitante o creado por"
          />
        </div>
      </div>
    </section>

    <section class="table-section">
      <div class="table-responsive">
        <table class="solicitudes-table">
          <thead>
            <tr>
              <th width="40px"></th>
              <!-- Columna para checkbox -->
              <th>ID</th>
              <th>Tipo</th>
              <th>Cliente</th>
              <th>Solicitante</th>
              <th>Fecha creación</th>
              <th>Creado por</th>
              <th>Fecha autorizado</th>
              <th>Autorizado por</th>
              <th>Fecha proceso</th>
              <th>Procesado por</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let solicitud of solicitudesFiltradas()"
              [class.selected]="solicitudSeleccionada?.id === solicitud.id"
              (click)="seleccionarSolicitud(solicitud)"
            >
              <td>
                <input
                  type="checkbox"
                  (click)="$event.stopPropagation()"
                  [(ngModel)]="solicitud.seleccionada"
                  class="select-checkbox"
                />
              </td>
              <td>{{ solicitud.id }}</td>
              <td>{{ solicitud.tipo }}</td>
              <td>{{ solicitud.cliente }}</td>
              <td>{{ solicitud.solicitante }}</td>
              <td>{{ solicitud.fechaCreacion | date : "medium" }}</td>
              <td>{{ solicitud.creadoPor }}</td>
              <td>{{ solicitud.fechaAutorizado | date : "medium" }}</td>
              <td>{{ solicitud.autorizadoPor }}</td>
              <td>{{ solicitud.fechaProceso | date : "medium" }}</td>
              <td>{{ solicitud.procesadoPor }}</td>
              <td>
                <span
                  class="estado-badge"
                  [class]="'estado-' + solicitud.estado.toLowerCase()"
                >
                  {{ solicitud.estado }}
                </span>
              </td>
              <td class="acciones">
                <!-- Botón de Orden -->
                <button
                  class="accion-btn orden-btn"
                  title="Generar orden"
                  (click)="generarOrden(solicitud.id); $event.stopPropagation()"
                >
                  <i class="fas fa-file-alt"></i>
                </button>

                <!-- Botón de Editar -->
                <button
                  class="accion-btn"
                  title="Editar"
                  (click)="
                    editarSolicitud(solicitud.id); $event.stopPropagation()
                  "
                >
                  <i class="fas fa-edit"></i>
                </button>

                <!-- Botón de Eliminar -->
                <button
                  class="accion-btn"
                  title="Eliminar"
                  (click)="
                    eliminarSolicitud(solicitud.id); $event.stopPropagation()
                  "
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="table-footer">
        <div class="pagination-controls">
          <button
            class="page-btn"
            [disabled]="paginaActual === 1"
            (click)="paginaAnterior()"
          >
            <i class="fas fa-chevron-left"></i>
          </button>
          <span>Página {{ paginaActual }} de {{ totalPaginas }}</span>
          <button
            class="page-btn"
            [disabled]="paginaActual === totalPaginas"
            (click)="paginaSiguiente()"
          >
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="total-registros">
          Total de registros: {{ solicitudes.length }}
        </div>
      </div>
    </section>
  </main>

  <!-- Formulario para facturar -->
  <div class="factura-form" *ngIf="showFacturaForm">
    <h3>Facturar - Solicitud {{ solicitudSeleccionada?.id }}</h3>

    <div class="form-group">
      <label>
        <input type="checkbox" [(ngModel)]="esFactura" /> Es factura
      </label>
    </div>

    <div *ngIf="esFactura">
      <div class="form-row">
        <div class="form-group">
          <label for="tipoEntrega">T. entrega:</label>
          <input type="text" id="tipoEntrega" [(ngModel)]="tipoEntrega" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="garantia">Garantía:</label>
          <input type="text" id="garantia" [(ngModel)]="garantia" />
        </div>

        <div class="form-group">
          <label for="cantidad">Cantidad:</label>
          <input type="number" id="cantidad" [(ngModel)]="cantidad" min="1" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="precioSinIVA">Precio sin IVA:</label>
          <input
            type="number"
            id="precioSinIVA"
            [(ngModel)]="precioSinIVA"
            min="0"
            step="0.01"
          />
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button class="btn-cancel" (click)="cancelarFactura()">Cancelar</button>
      <button class="btn-confirm" (click)="confirmarFactura()">
        Confirmar
      </button>
    </div>
  </div>

  <!-- Formulario para marcar como enterado -->
  <div class="enterado-form" *ngIf="showEnteradoForm">
    <h3>Marcar como enterado - Solicitud {{ solicitudSeleccionada?.id }}</h3>

    <div class="form-group">
      <label for="observacionesEnterado">Observaciones:</label>
      <textarea
        id="observacionesEnterado"
        [(ngModel)]="observacionesEnterado"
        rows="3"
        placeholder="Ingrese observaciones si es necesario"
      ></textarea>
    </div>

    <div class="form-group">
      <label for="fechaEnterado">Fecha:</label>
      <input type="date" id="fechaEnterado" [(ngModel)]="fechaEnterado" />
    </div>

    <div class="form-actions">
      <button class="btn-cancel" (click)="cancelarEnterado()">Cancelar</button>
      <button class="btn-confirm" (click)="confirmarEnterado()">
        Confirmar
      </button>
    </div>
  </div>

  <!-- Formulario para generar orden -->
  <div class="orden-form" *ngIf="showOrdenForm">
    <h3>Generar Orden - Solicitud {{ solicitudSeleccionada?.id }}</h3>

    <div class="form-group">
      <label for="observacionesOrden">Observaciones:</label>
      <textarea
        id="observacionesOrden"
        [(ngModel)]="observacionesOrden"
        rows="3"
        placeholder="Detalles de la orden..."
      ></textarea>
    </div>

    <div class="form-group">
      <label for="fechaOrden">Fecha:</label>
      <input type="date" id="fechaOrden" [(ngModel)]="fechaOrden" />
    </div>

    <div class="form-actions">
      <button class="btn-cancel" (click)="cancelarOrden()">Cancelar</button>
      <button class="btn-confirm" (click)="confirmarOrden()">
        Generar Orden
      </button>
    </div>
  </div>
</div>
